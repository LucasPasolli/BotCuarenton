{"version":3,"file":"translator.esm.js","sources":["../src/index.js"],"sourcesContent":["export default class Translator {\n    /**\n     *\n     * @return {Object}\n     */\n    get translation() {\n        if (this.translations[this.locale] !== undefined) {\n            return this.translations[this.locale];\n        }\n\n        if (this.translations[this.localeArea] !== undefined) {\n            return this.translations[this.localeArea];\n        }\n\n        if (this.translations[this.localeDefault] !== undefined) {\n            return this.translations[this.localeDefault];\n        }\n\n        return {};\n    }\n\n    /**\n     * @param {Object} translations\n     * @param {BBCode} [bbCodeParser]\n     * @param {String} [locale]\n     * @param {String} [localeArea]\n     * @param {String} [localeDefault]\n     * @param {RegExp} [regexpParameters]\n     * @param {RegExp} [regexpTranslations]\n     */\n    constructor(translations, {\n        bbCodeParser = undefined,\n        locale = 'en-GB',\n        localeArea = 'en-GB',\n        localeDefault = 'en-GB',\n        regexpParameters = /\\\\?\\[([^\\[\\]]+)\\]/g,\n        regexpTranslations = /[\\\\\\$]?\\{([^{}]+)\\}/g,\n    }) {\n        /**\n         * all translations in structure. structure is\n         *    LOCALE:\n         *        TRKEY => VALUE\n         *        ...\n         *\n         * TRKEY is defined bei \"TRFILE.TRINDEX\" given from backend\n         *\n         * @var {Object}\n         */\n        this.translations = {};\n\n        this.bbCodeParser       = bbCodeParser;\n        this.locale             = locale;\n        this.localeArea         = localeArea;\n        this.localeDefault      = localeDefault;\n        this.regexpParameters   = regexpParameters;\n        this.regexpTranslations = regexpTranslations;\n\n        this.setTranslations(translations);\n    }\n\n    /**\n     *\n     * @param {String} key\n     * @param {String} [defaults]\n     * @return {*}\n     */\n    getValueFromKey(key, defaults) {\n        const keys = key.split('.');\n\n        let text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translation);\n        if (text === undefined && this.translations[this.localeArea] !== undefined) {\n            text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translations[this.localeArea]);\n        }\n\n        if (text === undefined && this.translations[this.localeDefault] !== undefined) {\n            text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translations[this.localeDefault]);\n        }\n\n        if (text === undefined) {\n            if (defaults === undefined) {\n                return '{' + key + '}';\n            }\n            text = defaults;\n        }\n\n        return text;\n    }\n\n    /**\n     *\n     * @param {BBCode} bbCodeParser\n     * @return {Translator}\n     */\n    setBBCodeParser(bbCodeParser) {\n        this.bbCodeParser = bbCodeParser;\n\n        return this;\n    }\n\n    /**\n     * set Translations\n     *\n     * @param {Object} translations\n     * @returns {Translator}\n     */\n    setTranslations(translations) {\n        Object.entries(translations).forEach(([locale, values]) => {\n            if (this.translations[locale] === undefined) {\n                this.translations[locale] = {};\n            }\n\n            this.translations[locale] = {...values};\n        });\n\n        return this;\n    }\n\n    /**\n     * translate a text with given parameters\n     *\n     * @param {String} key\n     * @param {Object} [parameters]\n     * @param {String} [defaults]\n     * @returns {String}\n     */\n    translate(key, parameters, defaults) {\n        if (key === undefined || key === null) {\n            return key;\n        }\n\n        if (key.charAt(0) === '{') {\n            key = key.slice(1);\n        }\n        if (key.charAt(key.length - 1) === '}') {\n            key = key.slice(0, key.length - 1);\n        }\n\n        let text = this.getValueFromKey(key, defaults);\n        if (text === null || text === undefined) {\n            return text;\n        }\n\n        if (typeof text !== 'string') {\n            return text;\n        }\n\n        // parameter replacement\n        if (parameters instanceof Object) {\n            text = Object.keys(parameters).reduce((acc, name) => acc.replace(new RegExp('\\\\[' + name + '\\\\]', 'gi'), parameters[name]), text);\n        }\n\n        if (this.bbCodeParser === undefined) {\n            return text;\n        }\n\n        return this.bbCodeParser.parse(text);\n    };\n\n    /**\n     * inline translation\n     *\n     * @param {String} text\n     * @returns {String}\n     */\n    translateInline(text) {\n        // replace the text\n        text = text.replace(this.regexpTranslations, (match, key) => {\n            switch (match.charAt(0)) {\n                case '\\\\':\n                    return match.slice(1);\n                case '$':\n                    return match;\n            }\n\n            return this.translate(key, undefined, match);\n        });\n\n        return text;\n    };\n}\n"],"names":["Translator","translation","translations","locale","undefined","localeArea","localeDefault","constructor","bbCodeParser","regexpParameters","regexpTranslations","setTranslations","getValueFromKey","key","defaults","keys","split","text","reduce","acc","entry","setBBCodeParser","Object","entries","forEach","values","translate","parameters","charAt","slice","length","name","replace","RegExp","parse","translateInline","match"],"mappings":"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"}