{"version":3,"file":"translator.js","sources":["../src/index.js"],"sourcesContent":["export default class Translator {\n    /**\n     *\n     * @return {Object}\n     */\n    get translation() {\n        if (this.translations[this.locale] !== undefined) {\n            return this.translations[this.locale];\n        }\n\n        if (this.translations[this.localeArea] !== undefined) {\n            return this.translations[this.localeArea];\n        }\n\n        if (this.translations[this.localeDefault] !== undefined) {\n            return this.translations[this.localeDefault];\n        }\n\n        return {};\n    }\n\n    /**\n     * @param {Object} translations\n     * @param {BBCode} [bbCodeParser]\n     * @param {String} [locale]\n     * @param {String} [localeArea]\n     * @param {String} [localeDefault]\n     * @param {RegExp} [regexpParameters]\n     * @param {RegExp} [regexpTranslations]\n     */\n    constructor(translations, {\n        bbCodeParser = undefined,\n        locale = 'en-GB',\n        localeArea = 'en-GB',\n        localeDefault = 'en-GB',\n        regexpParameters = /\\\\?\\[([^\\[\\]]+)\\]/g,\n        regexpTranslations = /[\\\\\\$]?\\{([^{}]+)\\}/g,\n    }) {\n        /**\n         * all translations in structure. structure is\n         *    LOCALE:\n         *        TRKEY => VALUE\n         *        ...\n         *\n         * TRKEY is defined bei \"TRFILE.TRINDEX\" given from backend\n         *\n         * @var {Object}\n         */\n        this.translations = {};\n\n        this.bbCodeParser       = bbCodeParser;\n        this.locale             = locale;\n        this.localeArea         = localeArea;\n        this.localeDefault      = localeDefault;\n        this.regexpParameters   = regexpParameters;\n        this.regexpTranslations = regexpTranslations;\n\n        this.setTranslations(translations);\n    }\n\n    /**\n     *\n     * @param {String} key\n     * @param {String} [defaults]\n     * @return {*}\n     */\n    getValueFromKey(key, defaults) {\n        const keys = key.split('.');\n\n        let text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translation);\n        if (text === undefined && this.translations[this.localeArea] !== undefined) {\n            text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translations[this.localeArea]);\n        }\n\n        if (text === undefined && this.translations[this.localeDefault] !== undefined) {\n            text = keys.reduce((acc, entry) => acc[entry] ?? undefined, this.translations[this.localeDefault]);\n        }\n\n        if (text === undefined) {\n            if (defaults === undefined) {\n                return '{' + key + '}';\n            }\n            text = defaults;\n        }\n\n        return text;\n    }\n\n    /**\n     *\n     * @param {BBCode} bbCodeParser\n     * @return {Translator}\n     */\n    setBBCodeParser(bbCodeParser) {\n        this.bbCodeParser = bbCodeParser;\n\n        return this;\n    }\n\n    /**\n     * set Translations\n     *\n     * @param {Object} translations\n     * @returns {Translator}\n     */\n    setTranslations(translations) {\n        Object.entries(translations).forEach(([locale, values]) => {\n            if (this.translations[locale] === undefined) {\n                this.translations[locale] = {};\n            }\n\n            this.translations[locale] = {...values};\n        });\n\n        return this;\n    }\n\n    /**\n     * translate a text with given parameters\n     *\n     * @param {String} key\n     * @param {Object} [parameters]\n     * @param {String} [defaults]\n     * @returns {String}\n     */\n    translate(key, parameters, defaults) {\n        if (key === undefined || key === null) {\n            return key;\n        }\n\n        if (key.charAt(0) === '{') {\n            key = key.slice(1);\n        }\n        if (key.charAt(key.length - 1) === '}') {\n            key = key.slice(0, key.length - 1);\n        }\n\n        let text = this.getValueFromKey(key, defaults);\n        if (text === null || text === undefined) {\n            return text;\n        }\n\n        if (typeof text !== 'string') {\n            return text;\n        }\n\n        // parameter replacement\n        if (parameters instanceof Object) {\n            text = Object.keys(parameters).reduce((acc, name) => acc.replace(new RegExp('\\\\[' + name + '\\\\]', 'gi'), parameters[name]), text);\n        }\n\n        if (this.bbCodeParser === undefined) {\n            return text;\n        }\n\n        return this.bbCodeParser.parse(text);\n    };\n\n    /**\n     * inline translation\n     *\n     * @param {String} text\n     * @returns {String}\n     */\n    translateInline(text) {\n        // replace the text\n        text = text.replace(this.regexpTranslations, (match, key) => {\n            switch (match.charAt(0)) {\n                case '\\\\':\n                    return match.slice(1);\n                case '$':\n                    return match;\n            }\n\n            return this.translate(key, undefined, match);\n        });\n\n        return text;\n    };\n}\n"],"names":["Translator","translations","locale","undefined","localeArea","localeDefault","bbCodeParser","regexpParameters","regexpTranslations","setTranslations","key","defaults","keys","split","text","reduce","acc","entry","translation","Object","entries","forEach","values","parameters","charAt","slice","length","getValueFromKey","name","replace","RegExp","parse","match","translate"],"mappings":"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"}